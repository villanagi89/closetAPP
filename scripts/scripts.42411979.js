"use strict";var router=function(a){a.host="http://youcloset-api.herokuapp.com";var b=Backbone.Router.extend({routes:{"":"home",showArticles:"showArticles",uploadArticle:"uploadArticle",userSignUp:"userSignUp",userProfile:"myProfile"},home:function(){$("#content").empty().load("partials/mainPage.html")},showArticles:function(){$("#content").empty().load("partials/allArticles.html"),allArticles.init()},uploadArticle:function(){$("#content").empty().load("partials/image-upload.html")},userSignUp:function(){$("#content").empty().load("partials/signup.html")},myProfile:function(){$("#content").empty().load("partials/userProfile.html"),userProfile.init()}});return a.router=new b,a.backbone=function(){Backbone.history.start()},a}(router||{});$(document).ready(function(){router.backbone(),$("body").on("click","#uploadArticle",function(a){a.preventDefault(),aws.init()}),$("body").on("click","#signup-form",function(a){a.preventDefault(),userForm.init()})});var allArticles=function(a){return $(".categories").on("click",function(a){var b=a.target.id,c=".grid-items-lines ."+b;$(".grid-items-lines li").hide(),$(c).show()}),$("#allArticles").on("click",function(a){$(".grid-items-lines li").show()}),a.init=function(){$.ajax({url:"http://youcloset-api.herokuapp.com/users/1/articles",type:"GET",dataType:"JSON"}).done(function(a){console.log(a);var b=Handlebars.compile($("#all_articles_template").html());$("#content").html(b({articles:a}))}).fail(function(a,b,c){console.log(a,b,c)})},a}(allArticles||{}),aws=function(a){return a.init=function(){$.ajax({url:"http://youcloset-api.herokuapp.com/amazon/sign_key",type:"GET",dataType:"JSON"}).done(function(b){console.log(b),a.sendAwsRequest(b)}).fail(function(a,b,c){console.log(a,b,c)})},a.setPrefilter=function(){$.ajaxPrefilter(function(a){a.headers=a.headers||{},a.headers.Accept="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"})},a.sendAwsRequest=function(b){console.log(b),console.log("request"),a.setPrefilter();var c=new FormData,d=$("#file")[0].files[0];c.append("key",b.key),c.append("AWSAccessKeyId",b.access_key),c.append("policy",b.policy),c.append("signature",b.signature),c.append("Content-Type",d.type),c.append("file",d),$.ajax({url:"https://s3.amazonaws.com/you.closet.api",type:"POST",data:c,processData:!1,contentType:!1}).done(function(){console.log("uploaded to AWS"),a.sendAwsToRails(b)}).fail(function(a,b,c){console.log(a,b,c)})},a.sendAwsToRails=function(a){var b=$("#title").val(),c="https://s3.amazonaws.com/you.closet.api/"+a.key,d=$("#category :selected").val(),e=$("#article_type :selected").val();$.ajax({url:"http://youcloset-api.herokuapp.com/articles",type:"POST",data:{article:{name:b,url:c,category:d,article_type:e}}}).done(function(a){window.location.href="/",console.log(a)}).fail(function(a,b,c){console.log(a,b,c)})},a}(aws||{});$(document).ready(function(){}),$(document).ready(function(){var a=$("#js-centered-navigation-mobile-menu").unbind();$("#js-centered-navigation-menu").removeClass("show"),a.on("click",function(a){a.preventDefault(),$("#js-centered-navigation-menu").slideToggle(function(){$("#js-centered-navigation-menu").is(":hidden")&&$("#js-centered-navigation-menu").removeAttr("style")})})});var userForm=function(a){var b,c;return a.init=function(){b=localStorage.getItem("authToken"),c="https://youcloset-api.herokuapp.com",a.setupAjaxRequests(),a.submitRegistration(),$("#sign-out").on("click",a.signOut)},a.submitRegistration=function(){return $.ajax({url:c+"/users",type:"POST",data:{user:{email:$("#email").val(),username:$("#username").val(),password:$("#password").val()}}}).done(a.loginSuccess).fail(function(a,b,c){console.log(a,b,c)}),!1},a.loginSuccess=function(a){localStorage.setItem("authToken",a.token),console.log("Logged in!"),window.location.href="/"},a.submitLogin=function(){var b;return event.preventDefault(),b=$(this),$.ajax({url:c+"/users/sign_in",type:"POST",data:b.serialize()}).done(a.loginSuccess).fail(function(a,b,c){console.log(a,b,c)}),!1},a.setupAjaxRequests=function(){$.ajaxPrefilter(function(a){a.headers={},a.headers.AUTHORIZATION="Token token="+b})},a.acceptFailure=function(a){401===a.status&&(console.log("send to login screen"),window.location.href="/signin.html")},a.signOut=function(a){a.preventDefault(),localStorage.removeItem("authToken"),b=void 0,window.location.href="/signin.html"},a}(userForm||{}),userProfile=function(a){var b,c;return a.init=function(){b=localStorage.getItem("id"),c="https://youcloset-api.herokuapp.com",a.getUser(b)},a.getUser=function(b){$.ajax({url:c+"/users/"+b,type:"GET",dataType:"JSON"}).done(function(b){console.log(b);var c=Handlebars.compile($("#user_profile_template").html());$("#content").html(c({user:b})),$("form#add-closet-form").hide(),$("#createCloset").on("click",function(){$("form#add-closet-form").toggle(),$("#add-closet").on("click",function(b){b.preventDefault(),a.createCloset()})})}).fail(function(a,b,c){console.log(a,b,c)})},a.createCloset=function(a){a=localStorage.getItem("id"),$.ajax({url:c+"/users/"+a+"/closets",type:"POST",dataType:"JSON",data:{closet:{name:$("#name").val(),user_id:a}}}).done(function(a){console.log(a),location.reload()}).fail(function(a,b,c){console.log(a,b,c)})},a}(userProfile||{});